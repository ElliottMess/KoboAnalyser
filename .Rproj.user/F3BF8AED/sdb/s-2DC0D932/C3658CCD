{
    "collab_server" : "",
    "contents" : "\nlibrary(shiny)\nlibrary(readxl)\nsource(\"code/0-packages.R\")\nkobo_projectinit()\nmainDir <- getwd()\n\nui <- fluidPage(\n\n\n  tabsetPanel(\n\n      tabPanel(\"Introduction\",\n            fluidRow(\n              h1(\"Welcome to KoboAnalyser!\", align=\"center\"),\n              p(\"This tool will allow to explore your data collected through Kobo. \", align=\"center\"),\n              column(5,\n                  h2(\"Content of the tool\"),\n                  tags$ol(\n                    tags$li(strong(\"Introduction\"),\" (where you are right now): explaination of the main features of the  and a few instructions\"),\n                    tags$li(strong(\"Project configuration:\"),\" uploading your form and data\"),\n                    tags$li(strong(\"Output:\"),\" uploading your form and data\")\n                  ),\n                  br(),\n                  p(\"You can access those with the tabulations on the top of the page.\",strong(\" Watch out\"), \"Project configuration is needed !\")\n\n\n              ),\n              column(5, offset = 1,\n                     h2(\"Features\"),\n                     tags$ol(\n                      tags$li(strong(\"Generate a data exploration report\"),\" with bar graphs, summary and crosstabulation for all the questions in your form, including one disaggregation and your data analysis plan.\"),\n                      tags$li(strong(\"Generate bar graphs\"),\" for all the questions in your form, including with one disaggregation\"),\n                      tags$li(strong(\"Weight\"),\" your data according to your sammpling frame\"),\n                      tags$li(strong(\"Calculate indicators:\"),\" add variables with the data analysis plan.\")\n                     ),\n                     br(),\n                     p(\"You can access those with the 'Output' tab on the top of the page.\",strong(\" Watch out\"), \"Project configuration is needed !\")\n\n\n              )\n            ),\n            br(),\n            br(),\n            fluidRow(\n              column(12, offset = 5,\n              h2(\"  Instruction\")\n              ),\n              column(5,\n                h3(\"Export data from Kobo\"),\n                p(\"Both your form and data should be downloaded directly from kobo.\"),\n                p(\"When exporting your data from Kobo:\"),\n                tags$ol(\n                  tags$li(\"Select 'export type' as XLS\"),\n                  tags$li('XML values and headers'),\n                  tags$li('Include groups in headers'),\n                  tags$li(\"and 'Group seperator' as dot ('.') (see image below) \")\n                ),\n                p(strong(\"DO NOT\"),\"change the name of the columns or any cells in the data. Everything should be exactly as in the form.\"),\n                img(src=\"exportformat.png\", width=200)\n              ),\n              column(5, offset = 1,\n                  h3(\"Use the XLSform template supplied\"),\n                     p(\"In the folder 'code', you will find a XLSform template.\",\n                       br(),\n                       \"You will see that this template has three extra sheets:\",\n                       tags$ol(\n                         tags$li(\"'analysis_plan': where you can define your indicators or new variables if need\"),\n                         tags$li(\"'sampling_frame': where you can specify your sampling frame to weight your data according to the method given in Project Configuration\"),\n                         tags$li(\"'instruction': help on how to fill the new XLSform.\")\n                       ),\n                       \"Please see the 'instruction' on how to setup your XLSform for KoboAnalyser\")\n\n                       )\n                     )\n\n      ),\n\n      tabPanel(\"Project configuration\",\n\n      titlePanel(\"Configuring a few elements for your project\"),\n\n\n      mainPanel(\n\n      fluidRow(\n      #list files in \"data\" and make dropdown of choices. then select sheets to be used for data, analysis plan and sampling\n      column(5,\n        fileInput(\"datafile\", label = h4(\"Select the file with the data\"),accept = c(\".xlsx\",\".xls\",\".csv\")),\n        uiOutput(\"data_sheet\")\n      ),\n      column(5, offset = 2,\n        fileInput(\"form\", label = h4(\"Select the file with the form\"),accept = c(\".xlsx\"))\n      )),\n\n      fluidRow(\n        column(5,\n          radioButtons(\"weighting_sys\", h4(\"What kind of weighting system did you use?\"),\n                       choices = c(\"None\"=\"none\",\n                                   \"Sampling Frame\"=\"sampling_frame\",\n                                   \"Custom\"=\"custom\"))\n        ),\n        column(4,\n          conditionalPanel(condition='input.weighting_sys==\"sampling_frame\"',\n                           radioButtons(\"sampling\", h5(\"What kind of sampling methode did you use?\"),\n                                        choices = c(\"Simple random\"=\"simple_random\",\n                                                    \"2 stages random -st1\"=\"2_stages\",\n                                                    \"cluster sampling\"=\"cluster_sampling\"))\n                           )\n          )\n        ),\n      fluidRow(\n        radioButtons(\"analysis_plan\", h4(\"Did you use the analysis plan sheet?\"),\n                     choices = c(\"No\"=\"n\",\n                                 \"Yes\"=\"y\")),\n        uiOutput(\"files_uploaded\")\n\n\n      ),\n      fluidRow(\n\n        h2(\"Information about the report\"),\n        column(5,\n        textInput(\"report_name\", \"Name of the report\"),\n        textInput(\"location\", \"Where is the report written\")\n        ),\n        column(5,\n        textInput(\"author\", \"What is your name (author)?\"),\n        textInput(\"organisation\", \"What is your organisation?\")\n        )\n      )\n      ),\n      sidebarPanel(\n        h3(\"When you are all set, upload the files!\"),\n        br(),\n        actionButton(\"upload_files\",label = \"Upload files\"),\n        br(),\n        br(),\n        htmlOutput(\"textmessage\"),\n        br(),\n        br(),\n        uiOutput(\"dico\"),\n        br(),\n        br(),\n        htmlOutput(\"dicomessage\"),\n        print(mainDir)\n\n\n\n      )\n    ),\n\n    tabPanel(\"Output\",\n        titlePanel(\"Output\"),\n        sidebarLayout(position=\"left\",\n          mainPanel(\n\n          ),\n\n          sidebarPanel(\n            h4(\"Download outputs\"),\n            downloadButton(\"report\", \"Generate report\")\n\n          )\n        )\n\n    )\n  )\n)\nserver <- function(input, output,session) {\n\n    #Move the data and form to the data folder\n  observeEvent(input$upload_files,{\n    inFile_data <- input$datafile\n    file.copy(inFile_data$datapath,file.path(mainDir,\"/data/\",inFile_data$name),overwrite = T)\n    inFile_form <- input$form\n    file.copy(inFile_form$datapath,file.path(mainDir,\"/data/\",inFile_form$name),overwrite = T)\n    inFile_sheet <- input$data_sheet\n    inFile_weight <- input$weighting_sys\n    inFile_analysis <- input$analysis_plan\n    inFile_sampling <- input$sampling\n    inFile_report <- input$report_name\n    inFile_location <- input$location\n    inFile_author <- input$author\n    inFile_organisation <- input$organisation\n\n    #Path to file\n    configfile<-paste(mainDir,\"/code/0-config.R\",sep=\"\")\n    #Writting file\n    sink(configfile)\n    cat(\"#### Config file ###\\n\")\n    cat(\"\\n\")\n    cat(\"### Can be manualy edited or interactively rewritten using the function kobo_projectconfig() or kobo_shiny('app_projectconfig.R') \\n\")\n    cat(\"\\n\")\n    cat(\"### 1. Form   ###\\n\")\n    cat(paste(\"form<-'\",inFile_form$name,\"'\",sep=\"\"))\n    cat(\"\\n\")\n    cat(paste('path.to.form <- paste(\"data/',inFile_form$name,'\",sep=\"\") \\n',sep=\"\"))\n    cat(\"\\n\")\n    cat(\"\\n### 2. Main dataframe  ###\\n\")\n    cat(paste('path.to.data <- paste(\"data/',inFile_data$name,'\",sep=\"\") \\n',sep=\"\"))\n    cat(paste('datafile <-\"',inFile_data$name,'\"',sep=\"\"))\n    cat(\"\\n\")\n    cat(paste('data <- read_excel(\"data/',inFile_data$name,'\", sheet=\"',inFile_sheet,'\")',sep=\"\"))\n    cat(\"\\n\")\n    cat(\"### 1. Weighting system   ###\\n\")\n    cat(paste(\"usedweight<-'\",inFile_weight,\"'\",sep=\"\"))\n    cat(\"\\n\")\n    cat(\"####### 3.1 - Type of sampling used ###\\n\")\n    cat(paste('usedsampling <-\"',inFile_sampling,'\"',sep=\"\"))\n    cat(\"\\n\")\n    cat(\"###  4.- Used the data analysis plan\\n\")\n    cat(paste('analysis_plan <-\"',inFile_analysis,'\"',sep=\"\"))\n    cat(\"\\n\")\n    cat(\"###  5. General info on the project\\n\")\n    cat(paste('report_name <-\"',inFile_report,'\"',sep=\"\"))\n    cat(\"\\n\")\n    cat(paste('location <-\"',inFile_location,'\"',sep=\"\"))\n    cat(\"\\n\")\n    cat(paste('author <-\"',inFile_author,'\"',sep=\"\"))\n    cat(\"\\n\")\n    cat(paste('organisation <-\"',inFile_organisation,'\"',sep=\"\"))\n    cat(\"\\n\")\n    sink()\n    output$textmessage <- renderUI(HTML(paste(p(strong(\"Files uploaded and config files written\")),p(\"Now, build the dictionnary to link the form with the data\"))))\n    output$dico <- renderUI({\n\n      actionButton(\"dico\",label = \"Build dictionnary\")\n\n    })\n\n  })\n\n  observeEvent(input$dico,{\n    kobo_dico()\n    output$dicomessage <- renderUI(HTML(paste(p(strong(\"Dictionnary built!\"), p(\"All good, now go to the \",strong(\"'output' tab!\"))))))\n\n  })\n\n  output$data_sheet  <- renderUI({\n    inFile <- input$datafile\n      if(is.null(inFile)) return(NULL)\n    data_sheets <- excel_sheets(inFile$datapath)\n    radioButtons(\"data_sheet\",\"Select the sheet with your data\",data_sheets)\n  })\n\n\n  output$report <- downloadHandler(\n    filename = \"report.doc\",\n    content = function(file) {\n      # Copy the report file to a temporary directory before processing it, in\n      # case we don't have write permissions to the current working dir (which\n      # can happen when deployed).\n      tempReport <- file.path(tempdir(), \"report.Rmd\")\n      file.copy(\"report.Rmd\", tempReport, overwrite = TRUE)\n\n      # Set up parameters to pass to Rmd document\n      params <- list(n = input$slider)\n\n      # Knit the document, passing in the `params` list, and eval it in a\n      # child of the global environment (this isolates the code in the document\n      # from the code in this app).\n      rmarkdown::render(tempReport, output_file = file,\n                        params = params,\n                        envir = new.env(parent = globalenv())\n\n      )\n    }\n  )\n\n\n\n}\n\nshinyApp(ui = ui, server = server)\n",
    "created" : 1519297028538.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3082371669",
    "id" : "C3658CCD",
    "lastKnownWriteTime" : 1519371804,
    "last_content_update" : 1519371804505,
    "path" : "~/ACTED Afghanistan/8. AME/1. Guidelines and tools/11. Kobo/KoboAnalyser/KoboAnalyser/inst/shiny_examples/app_projectconfig.R",
    "project_path" : "inst/shiny_examples/app_projectconfig.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}